(this["webpackJsonpladybird-ui"]=this["webpackJsonpladybird-ui"]||[]).push([[0],{139:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(34),i=a.n(o),c=a(65),l=a(30),s=a(53),m=a.n(s),u=a(25),g=a(81),h=a.n(g),d=a(155),p=a(153),f=a(82),b=a.n(f),v=a(83),E=a.n(v),y=a(154),w=m()((function(e){return{logo:{maxHeight:"calc(112px + 1vmin)"}}})),x=function(){var e=w();return r.a.createElement(p.a,null,r.a.createElement("div",null,r.a.createElement("a",{href:"https://www.rctech.club",rel:"noopener noreferrer"},r.a.createElement("img",{className:e.logo,src:E.a,alt:"RCTECH"}))),r.a.createElement("div",null,r.a.createElement(y.a,{variant:"h1"},"Login")))},j=a(52),O=a(43),k=a(23),S=a(16),F=function(e){return function(t){var a=Object(n.useState)(),o=Object(u.a)(a,2),i=o[0],c=o[1],l=new j.a({uri:"https://phoenix.rctech.club/graphql",headers:{authorization:i?i.getAuthResponse().id_token:""}}),s=new O.a,m=new k.a({cache:s,link:l});return r.a.createElement(S.a,{client:m},r.a.createElement(e,Object.assign({googleUser:i,setGoogleUser:c,clientID:"798725565697-sfibjdadpcan9ks908dnl8p5k1dncmoq.apps.googleusercontent.com"},t)))}},_=a(35),I=a(59),W=a(44);function P(){var e=Object(I.a)(["\n  mutation Login {\n    login {\n      token\n      login_status\n      register\n    }\n  }\n"]);return P=function(){return e},e}var R=Object(W.a)(P()),T=Object(d.a)((function(e){return{container:{margin:"3vh auto"},text:{marginBottom:"2vh"}}})),U=F((function(e){var t=e.googleUser,a=e.setGoogleUser,o=e.clientID,i=e.location,c=e.history,l=T(),s=Object(n.useState)(!1),m=Object(u.a)(s,2),g=m[0],d=m[1],f=Object(_.a)(R),v=Object(u.a)(f,1)[0];sessionStorage.setItem("redirectTo",b.a.parse(i.search).redirectTo||"");return r.a.createElement(p.a,{className:l.container},r.a.createElement(x,null),r.a.createElement("div",{className:l.text},r.a.createElement(y.a,{variant:"h2"},"Welcome RC Lee Hall mate!"),r.a.createElement(y.a,{variant:"h5"},"To continue using our app, please sign in using your HKU account.")),r.a.createElement(h.a,{onSuccess:function(e){a(e),v().then((function(e){var a=e.data.login,n=a.token,r=a.login_status,o=a.register;if(r&&sessionStorage.getItem("redirectTo").length>0&&window.location.replace("https://".concat(sessionStorage.getItem("redirectTo"),"?id=").concat(n)),o){var i=function(){var e=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile();return{id:e.getId(),first_name:e.getGivenName(),last_name:e.getFamilyName(),image_url:e.getImageUrl(),email_id:e.getEmail()}}();c.push({pathname:"register",state:{user:i,googleUser:t,token:t.getAuthResponse().id_token}})}})).catch((function(e){alert("There was an error logging you in")}))},onRequest:function(){d(!0)},onFailure:function(){alert("Failed Google Login. Please try again.")},clientId:o,disabled:g,cookiePolicy:"single_host_origin"}),r.a.createElement(y.a,{variant:"h6",style:{margin:"40px 0"}},"If you keep coming back here after login, please"," ",r.a.createElement("a",{href:"https://".concat(sessionStorage.getItem("redirectTo"))},"click here")))})),$=a(156),N=a(163),C=a(162),q=a(160),z=a(157),A=a(159);function G(){var e=Object(I.a)(["\n  mutation Register($username: String!, $phone: String!, $room_no: String!) {\n    register(user: { username: $username, phone: $phone, room_no: $room_no }) {\n      username\n    }\n  }\n"]);return G=function(){return e},e}var L=Object(W.a)(G()),B=Object(d.a)({container:{margin:"3vh auto"},disclaimer:{margin:"1vmax"},form:{margin:"2vh auto"}}),H=F((function(e){var t=e.setGoogleUser,a=e.location,o=e.history,i=B(),c=Object(n.useState)({}),s=Object(u.a)(c,2),m=s[0],g=s[1],h=Object(_.a)(L),d=Object(u.a)(h,2),f=d[0],b=d[1],v=b.data,E=b.error,w=Object(_.a)(R),x=Object(u.a)(w,2),j=x[0],O=x[1],k=O.data,S=O.error;Object(n.useEffect)((function(){if((E||S)&&(console.log("register error:",E),console.log("login error:",S),o.replace({location:"/"})),k&&k.login&&k.login.token){var e=k.login.token;sessionStorage.getItem("redirectTo").length>0?window.location.replace("https://".concat(sessionStorage.getItem("redirectTo"),"?id=").concat(e)):window.location.replace("https://".concat(window.location.host,"?id=").concat(e))}else v&&v.register&&v.register.username&&j().then().catch()}),[v,E,j,k,S,a,o]);var F=function(e){m[e.target.id]=e.target.value,g(m)};if(void 0===a.state)return r.a.createElement(l.a,{to:"/"});t(a.state.googleUser);var I=a.state.user;return r.a.createElement(p.a,{className:i.container},r.a.createElement(y.a,{variant:"h3"},"Hello, ".concat(I.first_name)),r.a.createElement("div",{className:i.disclaimer},"To continue using our services, we require you to sign in with Google, in which you have successfully completed that step. While we implicitly have access to your Google account information, other important details such as your room number are needed to deliver the best user experience.",r.a.createElement("br",null),"By submitting the form below, you agree that we are allowed to store your info in our database. We will not share your personal data with any other 3rd party applications and services."),r.a.createElement($.a,{className:i.form},r.a.createElement(N.a,{required:!0},r.a.createElement(C.a,{htmlFor:"username"},"Username"),r.a.createElement(q.a,{id:"username","aria-describedby":"username-helper-text",onChange:F,inputProps:{maxLength:20}}),r.a.createElement(z.a,{id:"username-helper-text"},"For example: iamawesome. Only alphanumeric characters are allowed with a minimum length of 4 and a maximum length of 20.")),r.a.createElement(N.a,{required:!0},r.a.createElement(C.a,{htmlFor:"phone"},"Phone (Hong Kong)"),r.a.createElement(q.a,{id:"phone","aria-describedby":"phone-helper-text",onChange:F,type:"number",inputProps:{maxLength:8}}),r.a.createElement(z.a,{id:"phone-helper-text"},"For example: 12345678")),r.a.createElement(N.a,{required:!0},r.a.createElement(C.a,{htmlFor:"room_no"},"Room number"),r.a.createElement(q.a,{id:"room_no","aria-describedby":"room-helper-text",onChange:F,inputProps:{maxLength:5}}),r.a.createElement(z.a,{id:"room-helper-text"},"For example: 924A")),r.a.createElement(A.a,{type:"submit",onClick:function(){var e=function(e){for(var t=function(e){return!e||""===e},a=0,n=[{id:"username",method:function(e){return RegExp("^[0-9A-z]{4,20}$").test(e)}},{id:"phone",method:function(e){return RegExp("^[0-9]{8}$").test(e)}},{id:"room_no",name:"room number",method:function(e){return RegExp("^[0-9]{3,4}[A-Z]$").test(e)}}];a<n.length;a++){var r=n[a],o=e[r.id];if(t(o)||!r.method(o))return{validation:!1,field:{id:r.name?r.name:r.id,value:o}}}return{validation:!0}}(m),t=e.validation,a=e.field;t?f({variables:m}).then().catch():alert("".concat(a.id," of value ").concat(a.value," is not allowed."))}},"Submit")))})),D=m()((function(e){return{container:{textAlign:"center",justifyContent:"center",margin:"auto"}}}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var J=a(152),K=a(161),Z=a(90),M=Object(K.a)(Object(Z.a)({palette:{primary:{light:"#727394",main:"#464866",dark:"#1d213b"},secondary:{main:"#ef9a9a"},background:{default:"#fff"},error:{main:"#B00020"},user:{main:"#ce93d8"},others:{main:"#9fa8da"}},typography:{h1:{fontFamily:"Poppins, sans-serif",fontWeight:200,fontSize:"4em",margin:"20px 0"},h2:{fontFamily:"Poppins, sans-serif",fontWeight:200,margin:"20px 0",fontSize:"3em"},h3:{fontFamily:"Poppins, sans-serif",fontWeight:200,fontSize:"2em",margin:"20px 0"},h4:{fontFamily:"Poppins, sans-serif",fontWeight:200,margin:"20px 0"},h5:{fontFamily:"Poppins, sans-serif",fontWeight:200,fontSize:"1em"},h6:{fontFamily:"Roboto, sans-serif",fontWeight:400,fontSize:"1em"},subtitle1:{fontFamily:"Roboto, sans-serif",fontWeight:600},subtitle2:{fontFamily:"Roboto, sans-serif",fontWeight:200},button:{fontFamily:"Poppins, sans-serif",fontWeight:300}}})),Q=a(158);i.a.render(r.a.createElement(J.a,{theme:M},r.a.createElement(Q.a,null),r.a.createElement((function(){var e=D();return r.a.createElement("div",{className:e.container},r.a.createElement(c.a,null,r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"/",exact:!0,component:U}),r.a.createElement(l.b,{path:"/register",exact:!0,component:H}))))}),null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},83:function(e,t,a){e.exports=a.p+"static/media/logo.83c07097.png"},95:function(e,t,a){e.exports=a(139)}},[[95,1,2]]]);
//# sourceMappingURL=main.101e2666.chunk.js.map